<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>OKLab Color Picker</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- ── Toolbar ─────────────────────────────────────── -->
  <div class="toolbar">
    <button id="always-on-top-button" onclick="toggleAlwaysOnTop()">📌 Always on Top</button>
    <button onclick="pickColor()">💧 Pick Color <kbd style="opacity: 0.6; font-size: 10px">Alt+C</kbd></button>
  </div>

  <!-- ── Working Color Space Bar ──────────────────── -->
  <div class="cs-bar">
    <span class="cs-label">Working CS:</span>
    <span class="cs-name" id="cs-name-display" title="">Display P3</span>
    <button onclick="document.getElementById('icc-file-input').click()">📂 Import ICC</button>
    <button onclick="resetWorkingCS()" title="Reset to default (P3 or sRGB)">↺</button>
    <input type="file" id="icc-file-input" accept=".icm,.icc" onchange="handleICCImport(this)">
  </div>

  <!-- ── 2D Color Picker (a, b axes) ─────────────────── -->
  <div class="picker-wrap">
    <canvas id="ab-picker" width="300" height="300"></canvas>
    <span class="axis-label top">+b (yellow)</span>
    <span class="axis-label bottom">−b (blue)</span>
    <span class="axis-label left">−a (green)</span>
    <span class="axis-label right">+a (red)</span>
  </div>

  <!-- ── Lightness Slider ────────────────────────────── -->
  <canvas id="lightness-slider" class="slider-canvas" width="300" height="28"></canvas>
  <span class="slider-label">L: Lightness (0 → 1)</span>

  <!-- ── Chroma Slider ───────────────────────────────── -->
  <canvas id="chroma-slider" class="slider-canvas" width="300" height="28"></canvas>
  <span class="slider-label">C: Chroma (0 → 0.4)</span>

  <!-- ── Hue Slider ──────────────────────────────────── -->
  <canvas id="hue-slider" class="slider-canvas" width="300" height="28"></canvas>
  <span class="slider-label">h: Hue (0° → 360°)</span>

  <!-- ── Color Info Panel ────────────────────────────── -->
  <div id="info">
    <!-- Preview swatch + OKLab values -->
    <div class="color-row">
      <div id="color-preview"></div>
      <div id="oklab-values">
        L: <b><span class="editable-val" id="val-L" contenteditable="true" spellcheck="false"></span></b>&ensp;
        a: <b><span class="editable-val" id="val-a" contenteditable="true" spellcheck="false"></span></b>&ensp;
        b: <b><span class="editable-val" id="val-b" contenteditable="true" spellcheck="false"></span></b><br>
        C: <b><span class="editable-val" id="val-C" contenteditable="true" spellcheck="false"></span></b>&ensp;
        h: <b><span class="editable-val" id="val-h" contenteditable="true" spellcheck="false"></span></b>°
      </div>
    </div>

    <!-- sRGB hex code -->
    <div class="hex-row">
      <label>sRGB:</label>
      <span class="hex-value" id="srgb-hex" contenteditable="true" spellcheck="false"></span>
      <span id="srgb-gamut-indicator"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'srgb-hex')">📋</button>
    </div>

    <!-- Display P3 hex code (always shown) -->
    <div class="hex-row">
      <label>Display P3:</label>
      <span class="hex-value" id="display-p3-hex" contenteditable="true" spellcheck="false"></span>
      <span id="display-p3-gamut-indicator"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'display-p3-hex')">📋</button>
    </div>

    <!-- Working CS hex code (hidden when working CS is P3 or sRGB) -->
    <div class="hex-row" id="working-cs-row" style="display:none">
      <label id="working-cs-hex-label">Working:</label>
      <span class="hex-value" id="working-hex" contenteditable="true" spellcheck="false"></span>
      <span id="working-gamut-indicator"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'working-hex')">📋</button>
    </div>

    <!-- Raw CSS oklab() value -->
    <div class="hex-row">
      <label>CSS:</label>
      <span class="hex-value" id="css-oklab-value" contenteditable="true" spellcheck="false"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'css-oklab-value')">📋</button>
    </div>
  </div>

  <!-- ── Lighting Lab Toggle ─────────────────────────── -->
  <div class="toolbar" style="width:300px; margin:10px auto 0;">
    <button id="lighting-toggle-button" onclick="toggleLightingPanel()">💡 Lighting Lab</button>
  </div>

  <!-- ── Lighting Lab Panel (slide-out) ──────────────── -->
  <div id="lighting-panel">
    <hr class="lighting-divider">
    <div class="lighting-header">LIGHTING LAB</div>

    <!-- Mode tabs: which color the main picker edits -->
    <div class="mode-tabs">
      <button id="tab-albedo" class="tab-active" onclick="setEditTarget('albedo')">🎨 Albedo</button>
      <button id="tab-light" onclick="setEditTarget('light')">☀️ Light Color</button>
    </div>

    <!-- Equation: Albedo × Light = Result -->
    <div class="lighting-equation">
      <div class="lighting-swatch-wrap">
        <div class="swatch-label">Albedo</div>
        <div id="swatch-albedo" class="lighting-swatch selected" onclick="setEditTarget('albedo')"></div>
      </div>
      <div class="lighting-operator">×</div>
      <div class="lighting-swatch-wrap">
        <div class="swatch-label">Light</div>
        <div id="swatch-light" class="lighting-swatch" onclick="setEditTarget('light')"></div>
      </div>
      <div class="lighting-operator">=</div>
      <div class="lighting-swatch-wrap">
        <div class="swatch-label">Result</div>
        <div id="swatch-result" class="lighting-swatch read-only"></div>
      </div>
    </div>

    <!-- Light Intensity slider -->
    <div class="intensity-row">
      <label>☀️ Intensity:</label>
      <div class="intensity-track" id="intensity-track">
        <div class="intensity-fill" id="intensity-fill"></div>
        <div class="intensity-thumb" id="intensity-thumb"></div>
      </div>
      <span class="intensity-value" id="intensity-value" contenteditable="true" spellcheck="false">1.00</span>
    </div>

    <!-- Result mini a,b map (read-only) -->
    <canvas id="result-ab-map" width="150" height="150"></canvas>
    <span class="slider-label" style="width:150px; margin-top:4px;">Result in OKLab a,b plane</span>

    <!-- Result numeric values -->
    <div class="lighting-result-info" id="lighting-result-values"></div>
    <div class="hex-row" style="margin-top:6px">
      <label>sRGB:</label>
      <span class="hex-value" id="result-srgb-hex"></span>
      <span id="result-srgb-gamut"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'result-srgb-hex')">📋</button>
    </div>
    <div class="hex-row">
      <label>Display P3:</label>
      <span class="hex-value" id="result-p3-hex"></span>
      <span id="result-p3-gamut"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'result-p3-hex')">📋</button>
    </div>
    <div class="hex-row" id="result-wcs-row" style="display:none">
      <label id="result-wcs-label">Working:</label>
      <span class="hex-value" id="result-wcs-hex"></span>
      <span id="result-wcs-gamut"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'result-wcs-hex')">📋</button>
    </div>
    <div class="hex-row">
      <label>CSS:</label>
      <span class="hex-value" id="result-css-value"></span>
      <button class="copy-button" onclick="copyToClipboard(this, 'result-css-value')">📋</button>
    </div>
  </div>




  <!-- Scripts (loaded in dependency order) -->
  <script src="color-math.js"></script>
  <script src="color-spaces.js"></script>
  <script src="state.js"></script>
  <script src="persistence.js"></script>
  <script src="rendering.js"></script>
  <script src="interaction.js"></script>
  <script src="app.js"></script>

</body>
</html>
